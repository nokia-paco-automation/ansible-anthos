---
  - name: create namespace {{sw}}
    shell: kubectl create ns {{sw}}
    register: response
    failed_when:
      - response.rc > 1
      - response.rc == 1 and "already exists" not in result.stderr

  - name: create secret {{sw}}
    shell: kubectl create -n {{sw}} secret docker-registry {{paco_sw.harbor.name}} --docker-server={{paco_sw.harbor.server}} --docker-username='{{paco_sw.harbor.username}}' --docker-password={{paco_sw.harbor.secret}}  --docker-email={{paco_sw.harbor.email}}
    register: response
    failed_when:
      - response.rc > 1
      - response.rc == 1 and "already exists" not in result.stderr
  
  - name: Patch ServiceAccount {{sw}}
    shell: "kubectl patch serviceaccount default -n {{sw}} -p '{{ patch | to_json }}'"
    vars:
      patch:
        imagePullSecrets:
          - name: "{{ paco_sw.harbor.name }}"