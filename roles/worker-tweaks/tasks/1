---
- name: Copy /etc/sysctl.d/10-k8s-worker-tweaks
    become: true
    copy:
      src: 10-k8s-worker-tweaks
      dest: /etc/sysctl.d/
  
#  - name: apply kubelet configuration to the cluster
#    become: false
#    run_once: true
#    shell: kubectl apply -f ../build/kubelet-config-1.18.yaml
#    delegate_to: localhost

# - name: release daemon
#    systemd: 
#      state: restarted
#      daemon_reload: yes
#      name: kubelet 

- name: apply kubelet configuration to the node
  become: true
  lineinfile:
     path: /var/lib/kubelet/config.yaml
     line: 'cpuManagerPolicy: static'
- name: restart kubelet
  become: true
  shell: |
     rm -f /var/lib/kubelet/cpu_manager_state
     systemctl restart kubelet
 
